<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<title>lookup.safariextz setting window</title>
<style>
table th td {
  border: 1px #444 solid;
  margin: 0px;
  padding: 0px;
}
</style>
<script type="text/javascript" src="jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="jquery.tablednd_0_5.js"></script>
<script type="text/javascript">
const NUMMAXITEMS = 10;
$(document).ready(function() {
  var pattern = JSON.parse(localStorage.pattern);
  for (var i = 0; i < pattern.length; i++) {
    document.getElementById("title" + i).value = pattern[i].title;
    document.getElementById("url" + i).value = pattern[i].url;
    document.getElementById("command" + i).value = pattern[i].command;
  }
  $("#t1").tableDnD();
});

function save() {
  var pattern = [];
  var rows = document.querySelectorAll("tr");
  for (var i = 0; i < NUMMAXITEMS; i++) {
    var title = rows[i].children[0].children[0].value;
    var url = rows[i].children[1].children[0].value;
    var command = rows[i].children[2].children[0].value;
    if (title != "" && url != "" && command != "") {
      pattern.push({title: title, url: url, command: command});
    }
  }
  safari.self.tab.dispatchMessage("saveOption", {key: "pattern", value: JSON.stringify(pattern)});
}
</script>
</head>
<body>
  <table id="t1">
    <tr>
      <td><input id="title0" type="text"></td>
      <td><input id="url0" type="text" size="100"></td>
      <td><input id="command0" type="text"></td>
    </tr>
    <tr>
      <td><input id="title1" type="text"></td>
      <td><input id="url1" type="text" size="100"></td>
      <td><input id="command1" type="text"></td>
    </tr>
    <tr>
      <td><input id="title2" type="text"></td>
      <td><input id="url2" type="text" size="100"></td>
      <td><input id="command2" type="text"></td>
    </tr>
    <tr>
      <td><input id="title3" type="text"></td>
      <td><input id="url3" type="text" size="100"></td>
      <td><input id="command3" type="text"></td>
    </tr>
    <tr>
      <td><input id="title4" type="text"></td>
      <td><input id="url4" type="text" size="100"></td>
      <td><input id="command4" type="text"></td>
    </tr>
    <tr>
      <td><input id="title5" type="text"></td>
      <td><input id="url5" type="text" size="100"></td>
      <td><input id="command5" type="text"></td>
    </tr>
    <tr>
      <td><input id="title6" type="text"></td>
      <td><input id="url6" type="text" size="100"></td>
      <td><input id="command6" type="text"></td>
    </tr>
    <tr>
      <td><input id="title7" type="text"></td>
      <td><input id="url7" type="text" size="100"></td>
      <td><input id="command7" type="text"></td>
    </tr>
    <tr>
      <td><input id="title8" type="text"></td>
      <td><input id="url8" type="text" size="100"></td>
      <td><input id="command8" type="text"></td>
    </tr>
    <tr>
      <td><input id="title9" type="text"></td>
      <td><input id="url9" type="text" size="100"></td>
      <td><input id="command9" type="text"></td>
    </tr>  </table>
  <hr>
  <input type="button" onclick="save()" value="apply">
</body>
</html>